<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analysis of World Values Survey Data ‚Ä¢ flintyR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Analysis of World Values Survey Data">
<meta property="og:description" content="flintyR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flintyR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ex_vs_hom.html">Exchangeability and Homogeneity</a>
    </li>
    <li>
      <a href="../articles/extras.html">Extras</a>
    </li>
    <li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/single-cell-atac-seq.html">Analysis of scATAC-seq Data</a>
    </li>
    <li>
      <a href="../articles/wvs.html">Analysis of World Values Survey Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/alanaw1/flintyR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="wvs_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Analysis of World Values Survey Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/alanaw1/flintyR/blob/master/vignettes/wvs.Rmd"><code>vignettes/wvs.Rmd</code></a></small>
      <div class="hidden name"><code>wvs.Rmd</code></div>

    </div>

    
    
<p><em>We are grateful to <a href="https://www.lse.ac.uk/PBS/People/Rachel-Spicer">Rachel Spicer</a>, Post Doctoral Fellow at the London School of Economics and Political Science, for feedback on enhancing accessibility and reproducibility of this vignette.</em></p>
<p>In psychological studies, decades of analyses of data originating from primarily Western, Educated, Industrial, Rich and Democratic (WEIRD) societies have contributed to the lack of replicability and generalizability of findings (<a href="https://www.cambridge.org/core/journals/behavioral-and-brain-sciences/article/abs/weirdest-people-inthe-world/BF84F7517D56AFF7B7EB58411A554C17">Henrich et al., 2010</a>). This has motivated the development of metrics that quantify meaningful cultural differences between societies (<a href="https://journals.sagepub.com/doi/full/10.1177/0956797620916782">Muthukrishna et al., 2020</a>), which bear on the validity of porting results obtained from analyzing one population over to another different population.</p>
<p style="text-align:center;">
<img src="ex_data/WVS/aps_fig6.jpg" alt="" width="500"></p>
<p align="center">
<em>2D <a href="https://www.jstor.org/stable/2110441?seq=1">non-metric multidimensional scaling (NMDS)</a> plot generated from a distance matrix summarising how culturally distinct regions are. Each entry of the distance matrix reports the cultural fixation index (<span class="math inline">\(\text{CF}_{ST}\)</span>) between two regions. Also shown are distances within the regions, which capture within-nation variation. Figure reproduced from <a href="https://journals.sagepub.com/doi/full/10.1177/0956797620916782">Muthukrishna et al.¬†(2020)</a>, with permission from Michael Muthukrishna.</em>
</p>
In contrast to between-society differences that reflect important cultural heterogeneities, differences within putatively singular populations or societies could suggest the presence of distinct communities that reflect meaningful sociological or demographic characteristics. For example, it is known that genealogical communities exist within the United States, and the persistence of homogamous mating in such communities (the determinants of which include, some scholars have suggested, geographic isolation and homophilous sorting by transmitted cultural traits; see <a href="https://www.jstor.org/stable/223487?seq=1">Kalmijn, 1998</a> and <a href="https://press.princeton.edu/books/paperback/9780691082837/cultural-transmission-and-evolution-mpb-16-volume-16">Feldman and Cavalli-Sforza, 1981</a>) is manifested in genetic differences (<a href="https://www.nature.com/articles/ncomms14238">Han et al., 2017</a>). See the Figure below and pay attention to the French Canadians, the Amish, the New Mexicans and the Scandinavians.
<p style="text-align:center;">
<img src="ex_data/WVS/naturecomms_fig3.jpeg" alt="Distribution of ancestral birth locations in North America associated with IBD clusters" width="500"></p>
<p align="center">
<em>Distribution of ancestral birth locations in North America associated with clusters of individuals. A higher odds ratio (OR) implies that most present-day descendants of individuals from that ancestral birth location belong to the same cluster. Figure reproduced from <a href="https://www.nature.com/articles/ncomms14238">Han et al.¬†(2017)</a> under the Creative Commons Attribution (CC-BY) license.</em>
</p>
<p>üìñ In this vignette, we will:</p>
<ul>
<li>show how <strong>flinty</strong> can be used to provide evidence for the presence of distinct subpopulations within a single-population sample of individual responses to survey questionnaires,</li>
<li>demonstrate how <strong>flinty</strong> can generate exchangeable subsamples of individual ‚Äúculturomes‚Äù, in the absence of labels on the individuals.</li>
</ul>
<div id="world-values-survey-data" class="section level1">
<h1 class="hasAnchor">
<a href="#world-values-survey-data" class="anchor"></a>World Values Survey Data</h1>
<p>We obtain publicly available survey questionnaire response data from the <a href="https://www.worldvaluessurvey.org/wvs.jsp">World Values Survey (WVS)</a>. The WVS is a research program aimed at understanding how beliefs, values and norms change over time and across nations globally; it is the largest non-commercial, cross-national, and time-series survey of public attitudes and values around the world. Motivated by the question of within-society differences, we focus on interrogating the cultural homogeneity of Singaporeans based on a representative collection of responses to the WVS questionnaire. To illustrate our method we use data from Wave 6 of the WVS that was released in 2012. (A report by <a href="https://lkyspp.nus.edu.sg/docs/default-source/ips/ips-exchange-series-17.pdf">Mathew, Teo, Tay and Wang, 2021</a> analyzing Singaporeans from 2020‚Äôs Wave 7 of the WVS has been published by the Institute of Policy Studies; here is a <a href="https://lkyspp.nus.edu.sg/ips/news/details/attitudes-towards-institutions-politics-and-policies-key-findings-from-the-world-value-survey">press release</a>.)</p>
<p>To download the WVS data, please read the instructions in our <a href="https://github.com/alanaw1/exchangeability_test/tree/main/data-analysis/wvs">Github repo</a>.</p>
<p>The code below loads and describes the WVS data <em>before</em> running data processing steps.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Load packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="co">## Load the data</span>
<span class="co">## This file can be downloaded with registration from the WVS website</span>
<span class="va">wvs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"ex_data/WVS/F00007762-WV6_Data_R_v20180912.Rds"</span><span class="op">)</span>

<span class="co"># How many samples and how many features?</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">wvs</span><span class="op">)</span>
<span class="co">#&gt; [1] 89565   440</span>

<span class="co"># Show the wvs tibble before processing...</span>
<span class="va">wvs</span>
<span class="co">#&gt; # A tibble: 89,565 √ó 440</span>
<span class="co">#&gt;    V1     V2     V2A    V3    V4    V5    V6    V7    V8    V9    V10   V11   V12  </span>
<span class="co">#&gt;    &lt;labe&gt; &lt;labe&gt; &lt;labe&gt; &lt;lab&gt; &lt;lab&gt; &lt;lab&gt; &lt;lab&gt; &lt;lab&gt; &lt;lab&gt; &lt;lab&gt; &lt;lab&gt; &lt;lab&gt; &lt;lab&gt;</span>
<span class="co">#&gt;  1 6      12     12      1    1     1     1     -2    1     1     2     1     1    </span>
<span class="co">#&gt;  2 6      12     12      2    1     2     3      4    2     2     2     2     2    </span>
<span class="co">#&gt;  3 6      12     12      3    1     3     2      4    2     1     2     2     2    </span>
<span class="co">#&gt;  4 6      12     12      4    1     1     3      4    3     1     2     1     2    </span>
<span class="co">#&gt;  5 6      12     12      5    1     1     1      2    1     1     1     3     2    </span>
<span class="co">#&gt;  6 6      12     12      6    1     2     2      2    4     1     2     1     2    </span>
<span class="co">#&gt;  7 6      12     12      7    1     1     1      1    1     1     2     2     1    </span>
<span class="co">#&gt;  8 6      12     12      8    1     1     1      1    2     2     2     1     2    </span>
<span class="co">#&gt;  9 6      12     12      9    1     1     1      2    2     2     2     2     2    </span>
<span class="co">#&gt; 10 6      12     12     10    1     1     1      2    1     1     1     1     2    </span>
<span class="co">#&gt; # ‚Ä¶ with 89,555 more rows, and 427 more variables: V13 &lt;labelled&gt;, V14 &lt;labelled&gt;,</span>
<span class="co">#&gt; #   V15 &lt;labelled&gt;, V16 &lt;labelled&gt;, V17 &lt;labelled&gt;, V18 &lt;labelled&gt;,</span>
<span class="co">#&gt; #   V19 &lt;labelled&gt;, V20 &lt;labelled&gt;, V21 &lt;labelled&gt;, V22 &lt;labelled&gt;,</span>
<span class="co">#&gt; #   V23 &lt;labelled&gt;, V24 &lt;labelled&gt;, V25 &lt;labelled&gt;, V26 &lt;labelled&gt;,</span>
<span class="co">#&gt; #   V27 &lt;labelled&gt;, V28 &lt;labelled&gt;, V29 &lt;labelled&gt;, V30 &lt;labelled&gt;,</span>
<span class="co">#&gt; #   V31 &lt;labelled&gt;, V32 &lt;labelled&gt;, V33 &lt;labelled&gt;, V34 &lt;labelled&gt;,</span>
<span class="co">#&gt; #   V35 &lt;labelled&gt;, V36 &lt;labelled&gt;, V37 &lt;labelled&gt;, V38 &lt;labelled&gt;, ‚Ä¶</span>

<span class="co"># What doe each feature correspond to? </span>
<span class="va">feature_anno</span> <span class="op">&lt;-</span> <span class="va">wvs</span> <span class="op">%&gt;%</span> <span class="fu">map_chr</span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">$</span><span class="va">label</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">feature_anno</span><span class="op">)</span>
<span class="co">#&gt;                                 V1                                 V2 </span>
<span class="co">#&gt;                             "Wave"                     "Country Code" </span>
<span class="co">#&gt;                                V2A                                 V3 </span>
<span class="co">#&gt; "Country/regions [with split ups]"                 "Interview number" </span>
<span class="co">#&gt;                                 V4                                 V5 </span>
<span class="co">#&gt;        "Important in life: Family"       "Important in life: Friends"</span>

<span class="co"># What are the labels  (i.e., categories) attached to feature V2?</span>
<span class="co"># [!] Numbers do not indicate the number of samples with that label in the full dataset</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">wvs</span><span class="op">$</span><span class="va">V2</span>, <span class="st">"labels"</span><span class="op">)</span>
<span class="co">#&gt;    Missing; Unknown Not asked in survey      Not applicable           No answer </span>
<span class="co">#&gt;                  -5                  -4                  -3                  -2 </span>
<span class="co">#&gt;          Don't know             Algeria          Azerbaijan           Argentina </span>
<span class="co">#&gt;                  -1                  12                  31                  32 </span>
<span class="co">#&gt;           Australia             Armenia              Brazil             Belarus </span>
<span class="co">#&gt;                  36                  51                  76                 112 </span>
<span class="co">#&gt;               Chile               China              Taiwan            Colombia </span>
<span class="co">#&gt;                 152                 156                 158                 170 </span>
<span class="co">#&gt;              Cyprus             Ecuador             Estonia             Georgia </span>
<span class="co">#&gt;                 196                 218                 233                 268 </span>
<span class="co">#&gt;           Palestine             Germany               Ghana               Haiti </span>
<span class="co">#&gt;                 275                 276                 288                 332 </span>
<span class="co">#&gt;           Hong Kong               India                Iraq               Japan </span>
<span class="co">#&gt;                 344                 356                 368                 392 </span>
<span class="co">#&gt;          Kazakhstan              Jordan         South Korea              Kuwait </span>
<span class="co">#&gt;                 398                 400                 410                 414 </span>
<span class="co">#&gt;          Kyrgyzstan             Lebanon               Libya            Malaysia </span>
<span class="co">#&gt;                 417                 422                 434                 458 </span>
<span class="co">#&gt;              Mexico             Morocco         Netherlands         New Zealand </span>
<span class="co">#&gt;                 484                 504                 528                 554 </span>
<span class="co">#&gt;             Nigeria            Pakistan                Peru         Philippines </span>
<span class="co">#&gt;                 566                 586                 604                 608 </span>
<span class="co">#&gt;              Poland               Qatar             Romania              Russia </span>
<span class="co">#&gt;                 616                 634                 642                 643 </span>
<span class="co">#&gt;              Rwanda           Singapore            Slovenia        South Africa </span>
<span class="co">#&gt;                 646                 702                 705                 710 </span>
<span class="co">#&gt;            Zimbabwe               Spain              Sweden            Thailand </span>
<span class="co">#&gt;                 716                 724                 752                 764 </span>
<span class="co">#&gt; Trinidad and Tobago             Tunisia              Turkey             Ukraine </span>
<span class="co">#&gt;                 780                 788                 792                 804 </span>
<span class="co">#&gt;               Egypt       United States             Uruguay          Uzbekistan </span>
<span class="co">#&gt;                 818                 840                 858                 860 </span>
<span class="co">#&gt;               Yemen </span>
<span class="co">#&gt;                 887</span></code></pre></div>
<div id="data-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#data-processing" class="anchor"></a>Data Processing</h2>
<p>We mirror the approach taken by Muthukrishna et al.¬†(2020) ‚Äî itself built on the work of <a href="https://doi.org/10.1073/pnas.0903232106">Bell, Richerson and McElreath (2009)</a> ‚Äî to include only a subset of the questions as features and to recode responses to those questions. Concretely, we</p>
<ol style="list-style-type: decimal">
<li>Remove questions exploring personal idiosyncrasies rather than cultural beliefs (e.g., self-reported state of health is discarded);<br>
</li>
<li>Recode by pooling similar responses into a single numerical categorical response (e.g., ‚Äúvery important‚Äù and ‚Äúrather important‚Äù are pooled)</li>
</ol>
<p>We provide scripts accomplishing this in our <a href="https://github.com/alanaw1/exchangeability_test/tree/main/data-analysis/wvs">Github repo</a>.</p>
<p>To facilitate our presentation, we have saved data generated from performing Steps 1 and 2 above. Below is code to load and preview this saved file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Load the data </span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"ex_data/WVS/all_MM_num_filtered_recode.RData"</span><span class="op">)</span>

<span class="co">## View data</span>
<span class="va">wv_num_filtered_</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="co">#&gt;         Wave Country Code Country/regions [with split ups] Interview number</span>
<span class="co">#&gt; 1  2010-2013      Algeria                          Algeria                1</span>
<span class="co">#&gt; 2  2010-2013      Algeria                          Algeria                2</span>
<span class="co">#&gt; 3  2010-2013      Algeria                          Algeria                3</span>
<span class="co">#&gt; 4  2010-2013      Algeria                          Algeria                4</span>
<span class="co">#&gt; 5  2010-2013      Algeria                          Algeria                5</span>
<span class="co">#&gt; 6  2010-2013      Algeria                          Algeria                6</span>
<span class="co">#&gt; 7  2010-2013      Algeria                          Algeria                7</span>
<span class="co">#&gt; 8  2010-2013      Algeria                          Algeria                8</span>
<span class="co">#&gt; 9  2010-2013      Algeria                          Algeria                9</span>
<span class="co">#&gt; 10 2010-2013      Algeria                          Algeria               10</span>
<span class="co">#&gt;    Important in life: Family Important in life: Friends</span>
<span class="co">#&gt; 1                          1                          1</span>
<span class="co">#&gt; 2                          1                          1</span>
<span class="co">#&gt; 3                          1                          2</span>
<span class="co">#&gt; 4                          1                          1</span>
<span class="co">#&gt; 5                          1                          1</span>
<span class="co">#&gt; 6                          1                          1</span>
<span class="co">#&gt; 7                          1                          1</span>
<span class="co">#&gt; 8                          1                          1</span>
<span class="co">#&gt; 9                          1                          1</span>
<span class="co">#&gt; 10                         1                          1</span>
<span class="co">#&gt;    Important in life: Leisure time Important in life: Politics</span>
<span class="co">#&gt; 1                                1                          NA</span>
<span class="co">#&gt; 2                                2                           2</span>
<span class="co">#&gt; 3                                1                           2</span>
<span class="co">#&gt; 4                                2                           2</span>
<span class="co">#&gt; 5                                1                           1</span>
<span class="co">#&gt; 6                                1                           1</span>
<span class="co">#&gt; 7                                1                           1</span>
<span class="co">#&gt; 8                                1                           1</span>
<span class="co">#&gt; 9                                1                           1</span>
<span class="co">#&gt; 10                               1                           1</span>
<span class="co">#&gt;    Important in life: Work Important in life: Religion</span>
<span class="co">#&gt; 1                        1                           1</span>
<span class="co">#&gt; 2                        1                           1</span>
<span class="co">#&gt; 3                        1                           1</span>
<span class="co">#&gt; 4                        2                           1</span>
<span class="co">#&gt; 5                        1                           1</span>
<span class="co">#&gt; 6                        2                           1</span>
<span class="co">#&gt; 7                        1                           1</span>
<span class="co">#&gt; 8                        1                           1</span>
<span class="co">#&gt; 9                        1                           1</span>
<span class="co">#&gt; 10                       1                           1</span></code></pre></div>
<p>We restrict our samples to individuals from Singapore. We obtain a dataset <span class="math inline">\(\mathbf{X}\)</span> with <span class="math inline">\(N=1715\)</span> observations and <span class="math inline">\(51\)</span> categorical features, the first four of which are individual metadata. Thus there are <span class="math inline">\(P=47\)</span> questionnaire response features in total.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Select individuals from Singapore</span>
<span class="va">wv_filtered_sg</span> <span class="op">&lt;-</span> <span class="va">wv_num_filtered_</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">`Country Code`</span> <span class="op">==</span> <span class="st">"Singapore"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">select_if</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">remove_missing</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in filter(., `Country Code` == "Singapore"): object 'Country Code' not found</span>

<span class="co">## View data</span>
<span class="va">wv_filtered_sg</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="co">#&gt;         Wave Country Code Country/regions [with split ups] Interview number</span>
<span class="co">#&gt; 1  2010-2013    Singapore                        Singapore             1001</span>
<span class="co">#&gt; 2  2010-2013    Singapore                        Singapore             1002</span>
<span class="co">#&gt; 3  2010-2013    Singapore                        Singapore             1003</span>
<span class="co">#&gt; 5  2010-2013    Singapore                        Singapore             1005</span>
<span class="co">#&gt; 7  2010-2013    Singapore                        Singapore             1007</span>
<span class="co">#&gt; 8  2010-2013    Singapore                        Singapore             1008</span>
<span class="co">#&gt; 9  2010-2013    Singapore                        Singapore             1009</span>
<span class="co">#&gt; 10 2010-2013    Singapore                        Singapore             1010</span>
<span class="co">#&gt; 11 2010-2013    Singapore                        Singapore             1011</span>
<span class="co">#&gt; 12 2010-2013    Singapore                        Singapore             1012</span>
<span class="co">#&gt;    Important in life: Family Important in life: Friends</span>
<span class="co">#&gt; 1                          1                          1</span>
<span class="co">#&gt; 2                          1                          1</span>
<span class="co">#&gt; 3                          1                          1</span>
<span class="co">#&gt; 5                          1                          1</span>
<span class="co">#&gt; 7                          1                          1</span>
<span class="co">#&gt; 8                          1                          1</span>
<span class="co">#&gt; 9                          1                          1</span>
<span class="co">#&gt; 10                         1                          1</span>
<span class="co">#&gt; 11                         1                          1</span>
<span class="co">#&gt; 12                         1                          1</span>
<span class="co">#&gt;    Important in life: Leisure time Important in life: Politics</span>
<span class="co">#&gt; 1                                1                           2</span>
<span class="co">#&gt; 2                                1                           2</span>
<span class="co">#&gt; 3                                1                           2</span>
<span class="co">#&gt; 5                                1                           1</span>
<span class="co">#&gt; 7                                1                           1</span>
<span class="co">#&gt; 8                                1                           1</span>
<span class="co">#&gt; 9                                1                           1</span>
<span class="co">#&gt; 10                               1                           1</span>
<span class="co">#&gt; 11                               1                           1</span>
<span class="co">#&gt; 12                               1                           2</span>
<span class="co">#&gt;    Important in life: Work Important in life: Religion</span>
<span class="co">#&gt; 1                        1                           2</span>
<span class="co">#&gt; 2                        1                           1</span>
<span class="co">#&gt; 3                        1                           2</span>
<span class="co">#&gt; 5                        1                           1</span>
<span class="co">#&gt; 7                        1                           2</span>
<span class="co">#&gt; 8                        1                           1</span>
<span class="co">#&gt; 9                        1                           2</span>
<span class="co">#&gt; 10                       1                           1</span>
<span class="co">#&gt; 11                       1                           1</span>
<span class="co">#&gt; 12                       1                           1</span>

<span class="co">## Get data dimensions</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">wv_filtered_sg</span><span class="op">)</span>
<span class="co">#&gt; [1] 1715   51</span></code></pre></div>
</div>
<div id="one-hot-encoding" class="section level2">
<h2 class="hasAnchor">
<a href="#one-hot-encoding" class="anchor"></a>One-Hot Encoding</h2>
<p>A challenge in measuring distances between categorical survey response variables is to determine which distance correctly measures ‚Äúhow far apart‚Äù we believe different pairs of categories should be. For example, should ‚Äústrongly agree‚Äù and ‚Äúnot applicable‚Äù be more far apart than ‚Äústrongly disagree‚Äù and ‚Äúnot applicable‚Äù? (This always depends on the downstream task; e.g., are distances used for visualization, or for classification, or something else.)</p>
<p>To compute Hamming distances between categorical variables, we perform <em>one-hot encoding</em> of all categorical variables with more than two categories. One-hot encoding means we assume that distances between pairs of categories are agnostic to the categories themselves. For example, consider the variable ‚ÄúJustifiable: Homosexuality‚Äù. After recoding there are three categories, 0, 1 and 2. Since differences between categories 0, 1 and 2 are assumed not to depend on the choice of categories, we transform 0, 1 and 2 into <span class="math inline">\(3\)</span>-bits 100, 010 and 001, so that when computing Hamming distances between the categories, differences between any pair of categories is <span class="math inline">\(1\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Binarize array and generate block delimiters</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mltools</span><span class="op">)</span> <span class="co"># for one_hot to work</span>
<span class="va">wv_filtered_sg_bin</span> <span class="op">&lt;-</span> <span class="fu">one_hot</span><span class="op">(</span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">wv_filtered_sg</span><span class="op">[</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">51</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Check dimension of one-hot encoded matrix</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">wv_filtered_sg_bin</span><span class="op">)</span>
<span class="co">#&gt; [1] 1715  120</span>

<span class="co">## Get block delimiters </span>
<span class="va">block_membership</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">47</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Count number of levels in the factor </span>
  <span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">wv_filtered_sg</span><span class="op">[</span>,<span class="va">p</span><span class="op">+</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># Add to block delimiter vector accordingly</span>
  <span class="va">block_membership</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">block_membership</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">p</span>,<span class="va">k</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">block_delims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">47</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Find position of first occurrence of p in block_membership </span>
  <span class="va">block_delims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">block_delims</span>,<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">p</span>,<span class="va">block_membership</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
<div id="results" class="section level1">
<h1 class="hasAnchor">
<a href="#results" class="anchor"></a>Results</h1>
<div id="how-do-responses-correlate-with-one-another" class="section level2">
<h2 class="hasAnchor">
<a href="#how-do-responses-correlate-with-one-another" class="anchor"></a>How do responses correlate with one another?</h2>
<p>Before we run any tests of exchangeability, let us visualize, using a heatmap and a dendrogram, how responses to the different survey questions correlate with one another. To generate our dendrogram, we perform hierarchical clustering with Ward linkage and distance matrix constructed from sample-sample correlations. (See p.¬†21 of <a href="https://www.jstatsoft.org/article/view/v061i06">Charrad et al., 2014</a> for an explanation of the Ward linkage.) Note that we do not need the one-hot encoded version of <span class="math inline">\(\mathbf{X}\)</span> to accomplish this step.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Generate a dendrogram</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">dendextend</span><span class="op">)</span> <span class="co"># for ladderize to work</span>
<span class="va">features_hclust_Euclidean_ward</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">wv_filtered_sg</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
                                           method <span class="op">=</span> <span class="st">"ward.D"</span><span class="op">)</span>
<span class="va">features_dend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html">as.dendrogram</a></span><span class="op">(</span><span class="va">features_hclust_Euclidean_ward</span><span class="op">)</span> <span class="co"># generate dendrogram for plotting heat map with</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Generate heat map to visualize correlations</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span> <span class="co"># for brewer.pal to work</span>
<span class="va">color.scheme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">10</span>,<span class="st">"RdBu"</span><span class="op">)</span><span class="op">)</span> <span class="co"># generate the color scheme to use</span>

<span class="fu"><a href="https://rdrr.io/r/stats/heatmap.html">heatmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">wv_filtered_sg</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
        Rowv <span class="op">=</span> <span class="fu">ladderize</span><span class="op">(</span><span class="va">features_dend</span><span class="op">)</span>,
        Colv <span class="op">=</span> <span class="fu">ladderize</span><span class="op">(</span><span class="va">features_dend</span><span class="op">)</span>,
        cexRow <span class="op">=</span> <span class="fl">0.3</span>,
        cexCol <span class="op">=</span> <span class="fl">0.3</span>,
        margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/wvs_5-1-1.png" alt=""><p class="caption">plot of chunk wvs_5-1</p>
</div>
<p>Even though we have to zoom into the figure for details, we already see that there are groups of features that are more correlated with one another. Here are three examples:</p>
<ul>
<li>Group 1: Responses to Question IDs 38 to 46 (rightmost clade of dendrogram)</li>
<li>Group 2: Responses to Question IDs 6, 33, 34, 35, and 36 (next rightmost clade after Group 1 clade)</li>
<li>Group 3: Responses to Question IDs 4, 5, and 24 (a very small clade left of Group 2 clade)</li>
</ul>
<p>The questions corresponding to the IDs are printed below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Print table of responses with IDs</span>
<span class="fu">kableExtra</span><span class="fu">::</span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">wv_filtered_sg</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                             Question <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">wv_filtered_sg</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:right;">
ID
</th>
<th style="text-align:left;">
Question
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Important in life: Family
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Important in life: Friends
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Important in life: Leisure time
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Important in life: Politics
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Important in life: Work
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Important in life: Religion
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Important child qualities: independence
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Important child qualities: Hard work
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Important child qualities: Feeling of responsibility
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Important child qualities: Imagination
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Important child qualities: Tolerance and respect for other people
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Important child qualities: Thrift saving money and things
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Important child qualities: Religious faith
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
Important child qualities: Unselfishness
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:left;">
Important child qualities: Obedience
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
Most people can be trusted
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
On the whole, men make better political leaders than women do
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
Aims of country: first choice
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
Aims of respondent: first choice
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
Most important: first choice
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:left;">
Future changes: Less importance placed on work in our lives
</td>
</tr>
<tr>
<td style="text-align:right;">
22
</td>
<td style="text-align:left;">
Future changes: Greater respect for authority
</td>
</tr>
<tr>
<td style="text-align:right;">
23
</td>
<td style="text-align:left;">
Protecting environment vs.¬†Economic growth
</td>
</tr>
<tr>
<td style="text-align:right;">
24
</td>
<td style="text-align:left;">
Interest in politics
</td>
</tr>
<tr>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
Income equality
</td>
</tr>
<tr>
<td style="text-align:right;">
26
</td>
<td style="text-align:left;">
Private vs state ownership of business
</td>
</tr>
<tr>
<td style="text-align:right;">
27
</td>
<td style="text-align:left;">
Government responsibility
</td>
</tr>
<tr>
<td style="text-align:right;">
28
</td>
<td style="text-align:left;">
Competition good or harmful
</td>
</tr>
<tr>
<td style="text-align:right;">
29
</td>
<td style="text-align:left;">
Political system: Having a strong leader who does not have to bother with parli
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
Political system: Having the army rule
</td>
</tr>
<tr>
<td style="text-align:right;">
31
</td>
<td style="text-align:left;">
Political system: Having a democratic political system
</td>
</tr>
<tr>
<td style="text-align:right;">
32
</td>
<td style="text-align:left;">
Thinking about meaning and purpose of life
</td>
</tr>
<tr>
<td style="text-align:right;">
33
</td>
<td style="text-align:left;">
How often do you attend religious services
</td>
</tr>
<tr>
<td style="text-align:right;">
34
</td>
<td style="text-align:left;">
Religious person
</td>
</tr>
<tr>
<td style="text-align:right;">
35
</td>
<td style="text-align:left;">
Believe in: God
</td>
</tr>
<tr>
<td style="text-align:right;">
36
</td>
<td style="text-align:left;">
Believe in: hell
</td>
</tr>
<tr>
<td style="text-align:right;">
37
</td>
<td style="text-align:left;">
How important is God in your life
</td>
</tr>
<tr>
<td style="text-align:right;">
38
</td>
<td style="text-align:left;">
Justifiable: Claiming government benefits to which you are not entitled
</td>
</tr>
<tr>
<td style="text-align:right;">
39
</td>
<td style="text-align:left;">
Justifiable: Avoiding a fare on public transport
</td>
</tr>
<tr>
<td style="text-align:right;">
40
</td>
<td style="text-align:left;">
Justifiable: Cheating on taxes if you have a chance
</td>
</tr>
<tr>
<td style="text-align:right;">
41
</td>
<td style="text-align:left;">
Justifiable: Someone accepting a bribe in the course of their duties
</td>
</tr>
<tr>
<td style="text-align:right;">
42
</td>
<td style="text-align:left;">
Justifiable: Homosexuality
</td>
</tr>
<tr>
<td style="text-align:right;">
43
</td>
<td style="text-align:left;">
Justifiable: Prostitution
</td>
</tr>
<tr>
<td style="text-align:right;">
44
</td>
<td style="text-align:left;">
Justifiable: Abortion
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:left;">
Justifiable: Divorce
</td>
</tr>
<tr>
<td style="text-align:right;">
46
</td>
<td style="text-align:left;">
Justifiable: Suicide
</td>
</tr>
<tr>
<td style="text-align:right;">
47
</td>
<td style="text-align:left;">
How proud of nationality
</td>
</tr>
</tbody>
</table>
<p>We thus see that Group 1 corresponds to ‚Äúgovernment and the law‚Äù, Group 2 corresponds to religion, and Group 3 corresponds to politics. Interestingly, ‚ÄúImportant in life: Work‚Äù is grouped with politics.</p>
</div>
<div id="are-singaporeans-culturally-homogeneous" class="section level2">
<h2 class="hasAnchor">
<a href="#are-singaporeans-culturally-homogeneous" class="anchor"></a>Are Singaporeans Culturally Homogeneous?</h2>
<p>Our first goal is to check whether our entire sample is homogeneous. We run our test, using block delimiters that demarcate one-hot encoded responses.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Load packages and set directories</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://alanaw1.github.io/flintyR">flintyR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">doParallel</span><span class="op">)</span>
<span class="co"># Register parallel computation</span>
<span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## Get p-value</span>
<span class="fu"><a href="../reference/getPValue.html">getPValue</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">wv_filtered_sg_bin</span><span class="op">)</span>,  
          block_boundaries <span class="op">=</span> <span class="va">block_delims</span>,
          largeP <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># since P is almost 50 we use asymptotic test</span>
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p>We obtain a <span class="math inline">\(p\)</span>-value of <span class="math inline">\(0\)</span>. This is not surprising, given that (as we‚Äôve just seen) the assumption of statistical independence between responses is likely false. Next, we try grouping these features into <span class="math inline">\(B\)</span> blocks (<span class="math inline">\(B\leqslant P\)</span>) based on the same hierarchical clustering procedure we used to visualize correlations. We still find that no matter how many blocks <span class="math inline">\(B\)</span> we select (amounting to cutting the clustering dendrogram to form <span class="math inline">\(B\)</span> clusters), we still obtain <span class="math inline">\(p=0\)</span>. Below, we show an example of this computation for <span class="math inline">\(B=6\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Cluster features into k = 6 groups to obtain feature grouping</span>
<span class="va">dist_matrix_Euclidean</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span><span class="op">(</span><span class="va">wv_filtered_sg</span><span class="op">[</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">51</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span> <span class="co"># L2 distance</span>
<span class="va">hclust_Euclidean_ward</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="va">dist_matrix_Euclidean</span>, method <span class="op">=</span> <span class="st">"ward.D"</span><span class="op">)</span>
<span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">hclust_Euclidean_ward</span>, k <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## Get block delimiters from group membership</span>
<span class="va">block_membership</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">47</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Count number of levels in the factor </span>
  <span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">wv_filtered_sg</span><span class="op">[</span>,<span class="va">p</span><span class="op">+</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># Add to block delimiter vector accordingly</span>
  <span class="va">which_group</span> <span class="op">&lt;-</span> <span class="va">clusters</span><span class="op">[</span><span class="va">p</span>,<span class="op">]</span>  
  <span class="va">block_membership</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">block_membership</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">which_group</span>,<span class="va">k</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## Compute p-value with block boundaries obtained from feature grouping</span>
<span class="fu"><a href="../reference/getPValue.html">getPValue</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">wv_filtered_sg_bin</span><span class="op">)</span>,
          block_labels <span class="op">=</span> <span class="va">block_membership</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p>This suggests the correlation structure between the features is complex, and it is likely that there are clusters within the samples that have distinct cluster-specific correlation structures between their features. In a demographic context, we suspect that there are distinct communities of Singaporeans, wherein the responses to the WVS questions have correlation patterns unique to the community.</p>
</div>
<div id="what-patterns-of-variation-characterize-exchangeable-clusters-of-singaporeans" class="section level2">
<h2 class="hasAnchor">
<a href="#what-patterns-of-variation-characterize-exchangeable-clusters-of-singaporeans" class="anchor"></a>What Patterns of Variation Characterize Exchangeable Clusters of Singaporeans?</h2>
<p>Motivated by evidence of heterogeneity, we try to find distinct communities of Singaporeans within our sample. Similar to how we grouped our features, we cluster the samples using hierarchical clustering with Ward linkage and distance matrix constructed from Euclidean distances computed between samples. We assume that such a clustering is efficacious at recovering demographically meaningful communities. We obtain <span class="math inline">\(K=10\)</span> as the optimal number of clusters using the Dindex metric. (See p.¬†14 of <a href="https://www.jstatsoft.org/article/view/v061i06">Charrad et al., 2014</a> for an explanation of how the Dindex works.)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Perform tuning to decide the optimal number of clusters </span>
<span class="co">## K to group samples into</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">NbClust</span><span class="op">)</span> <span class="co"># for NbClust to work</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">NbClust</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span><span class="op">(</span><span class="va">wv_filtered_sg</span><span class="op">[</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">51</span><span class="op">]</span><span class="op">)</span>,
               distance <span class="op">=</span> <span class="st">"euclidean"</span>, 
               min.nc <span class="op">=</span> <span class="fl">2</span>, 
               max.nc <span class="op">=</span> <span class="fl">12</span>, 
               method <span class="op">=</span> <span class="st">"ward.D2"</span>,
               index <span class="op">=</span> <span class="st">"dindex"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/wvs_9-1.png" alt=""><p class="caption">plot of chunk wvs_9</p>
</div>
<pre><code>#&gt; *** : The D index is a graphical method of determining the number of clusters. 
#&gt;                 In the plot of D index, we seek a significant knee (the significant peak in Dindex
#&gt;                 second differences plot) that corresponds to a significant increase of the value of
#&gt;                 the measure. 
#&gt; 

## Minimize clustering gain on Dindex
-diff(res$All.index) #  minimized at q = 11, so N_opt = (q - 1) = 10
#&gt;      3      4      5      6      7      8      9     10     11     12 
#&gt; 0.0738 0.0516 0.0447 0.0419 0.0278 0.0200 0.0215 0.0213 0.0153 0.0161

## Perform hierarchical clustering
samples_dist_matrix_Euclidean &lt;- stats::dist(data.matrix(wv_filtered_sg[,5:51]), method = "euclidean") # L2 distance
samples_hclust_Euclidean_ward &lt;- hclust(samples_dist_matrix_Euclidean, method = "ward.D")

## Obtain cluster membership for K = 10 clusters
samples_clusters &lt;- cutree(samples_hclust_Euclidean_ward, k = 10)</code></pre>
<p>After obtaining <span class="math inline">\(10\)</span> clusters, we group the features independently <em>for each sample cluster</em> using the same hierarchical clustering approach. We then perform the block version of our test at multiple number of blocks <span class="math inline">\(B\)</span> partitioning our features, where each configuration corresponds to cutting the clustering dendrogram to form <span class="math inline">\(B\)</span> feature clusters. Below, we demonstrate an example of this procedure for one cluster containing <span class="math inline">\(241\)</span> individuals.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Select subsample corresponding to Cluster 8</span>
<span class="va">sg_c8</span> <span class="op">&lt;-</span> <span class="va">wv_filtered_sg</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">samples_clusters</span> <span class="op">==</span> <span class="fl">8</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">sg_c8</span> <span class="op">&lt;-</span> <span class="va">sg_c8</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span> <span class="co"># remove metadata</span>

<span class="co">## Check that each feature has at least two categorical levels </span>
<span class="va">sg_c8</span> <span class="op">%&gt;%</span> 
  <span class="fu">map</span><span class="op">(</span><span class="va">levels</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># get levels per feature</span>
  <span class="fu">map</span><span class="op">(</span><span class="va">length</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># get number of levels </span>
  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># collapse into vector</span>
<span class="co">#&gt;  [1] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 4 4 4 3 3 3 2 3 3 3 3 2 2 2 4 3 2 2 2 3 3 3</span>
<span class="co">#&gt; [40] 3 3 3 3 3 3 3 2</span>

<span class="co">## Perform feature clustering</span>
<span class="va">c8features_hclust_Euclidean_ward</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span><span class="op">(</span><span class="va">sg_c8</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
                                           method <span class="op">=</span> <span class="st">"ward.D"</span><span class="op">)</span>
<span class="va">c8features_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">c8features_hclust_Euclidean_ward</span>, k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> 

<span class="co">## Binarize array</span>
<span class="va">sg_c8_bin</span> <span class="op">&lt;-</span> <span class="fu">one_hot</span><span class="op">(</span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">sg_c8</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Get block delimiters from group membership</span>
<span class="va">block_membership</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">47</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Count number of levels in the factor </span>
  <span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">sg_c8</span><span class="op">[</span>,<span class="va">p</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># Add to block delimiter vector accordingly</span>
  <span class="va">which_group</span> <span class="op">&lt;-</span> <span class="va">c8features_clusters</span><span class="op">[</span><span class="va">p</span><span class="op">]</span>  
  <span class="va">block_membership</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">block_membership</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">which_group</span>,<span class="va">k</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## Compute p-value with block boundaries obtained from feature grouping</span>
<span class="fu"><a href="../reference/getPValue.html">getPValue</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">sg_c8_bin</span><span class="op">)</span>,
          block_labels <span class="op">=</span> <span class="va">block_membership</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.1484</span></code></pre></div>
<p>After performing the steps described, we find that all but one cluster (Cluster 8, shown in the code chunk above) returned significant <span class="math inline">\(p\)</span>-values that imply heterogeneity. However, for the only homogeneous cluster, we find that up to <span class="math inline">\(B=10\)</span> blocks, the samples appear homogeneous. This is no longer true when we treat all <span class="math inline">\(P=47\)</span> features as statistically independent. Thus, for this cluster, the variation in responses can be attributed to partitionable feature dependencies.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Compute p-value when assuming features are statistically independent</span>
<span class="co"># [!] This should return p-value of 0</span>
<span class="fu"><a href="../reference/getPValue.html">getPValue</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">sg_c8_bin</span><span class="op">)</span>,  
          block_boundaries <span class="op">=</span> <span class="va">block_delims</span>,
          largeP <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># since P is almost 50 we use asymptotic test</span>
<span class="co">#&gt; [1] 8.881366e-13</span></code></pre></div>
<p>Now that we have found an exchangeable cluster of Singaporeans, we characterize the feature dependencies for this community of individuals.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Generate heatmap with dendrogram capturing feature-feature correlations</span>
<span class="va">c8features_dend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html">as.dendrogram</a></span><span class="op">(</span><span class="va">c8features_hclust_Euclidean_ward</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/heatmap.html">heatmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span><span class="op">(</span><span class="va">sg_c8</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
        Rowv <span class="op">=</span> <span class="fu">ladderize</span><span class="op">(</span><span class="va">c8features_dend</span><span class="op">)</span>,
        Colv <span class="op">=</span> <span class="fu">ladderize</span><span class="op">(</span><span class="va">c8features_dend</span><span class="op">)</span>,
        cexRow <span class="op">=</span> <span class="fl">0.3</span>,
        cexCol <span class="op">=</span> <span class="fl">0.3</span>,
        margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p style="text-align:center;">
<img src="ex_data/WVS/c8_heatmap.jpg" alt="" width="500"></p>
<p>Here, we see that there are groups of features that are more correlated with one another. Here are three examples:</p>
<ul>
<li>Group 1: Responses to Question IDs 26, 27, and 28 (rightmost clade of dendrogram)</li>
<li>Group 2: Responses to Question IDs 38 to 40 (next rightmost clade after Group 1 clade)</li>
<li>Group 3: Responses to Question IDs 41 to 46 (clade a little right of the middle of dendrogram)</li>
</ul>
<p>By looking back at the questions corresponding to the IDs, we see that Group 1 has to do with corporate culture. Moreover, unlike in the entire sample where Groups 2 and 3 were previously seen to be grouped as one, here they are grouped separately. Upon closer inspection, we notice that IDs 38 to 40 pertain more to obeying civil laws, while IDs 41 to 46 pertain more to moral and/or religious values. Thus, for this cluster we find a different relationship between two groups of traits that were previously agglomerated into one when viewed sample-wide.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alan Aw.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
